# **üìå –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ 2: –í–Ω–µ–¥—Ä–µ–Ω–∏–µ `Depends()` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–æ–º –∏ –ë–î**

**–¶–µ–ª—å**: –î–æ–±–∞–≤–∏—Ç—å **–∏–º–∏—Ç–∞—Ü–∏—é –º–µ—Ö–∞–Ω–∏–∑–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏** –∏ **–∏–º–∏—Ç–∞—Ü–∏—é —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö** —Å –ø–æ–º–æ—â—å—é `Depends()`.

### **üîπ –ó–∞–¥–∞—á–∏**
1. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É API-–∫–ª—é—á–∞ (`API_KEY`) —á–µ—Ä–µ–∑ `Depends()`**.  
   - –ï—Å–ª–∏ –∫–ª—é—á –Ω–µ–≤–µ—Ä–Ω—ã–π ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `401 Unauthorized`.  
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥–ª—è –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤, **–∫—Ä–æ–º–µ `GET /books`**.  

2. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å "–±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö" (`Depends(get_db)`)**.  
   - –°–µ–π—á–∞—Å –∫–Ω–∏–≥–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `books_db` (—Å–ª–æ–≤–∞—Ä—å).  
   - –§—É–Ω–∫—Ü–∏—è `get_db()` –¥–æ–ª–∂–Ω–∞ **–≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —ç—Ç–æ—Ç —Å–ª–æ–≤–∞—Ä—å**.  
   - **–î–æ–±–∞–≤–∏—Ç—å `Depends(get_db)` –≤ –∫–∞–∂–¥—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç, —Ä–∞–±–æ—Ç–∞—é—â–∏–π —Å –∫–Ω–∏–≥–∞–º–∏**.  

---

### **üìå –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–æ–¥—É**
1. **–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `dependencies.py`**
   - –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö `Books`
   - –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ø—Å–µ–≤–¥–æ-–ë–î `books_db`
   - –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `verify_api_key(api_key: str)`, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç API-–∫–ª—é—á.  
   - –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `get_db()`, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Å–µ–≤–¥–æ-–ë–î (`books_db`).  

2. **–û–±–Ω–æ–≤–∏—Ç—å `books.py`**
   - –î–æ–±–∞–≤–∏—Ç—å `Depends(verify_api_key)` –∫–æ **–≤—Å–µ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º, –∫—Ä–æ–º–µ `GET /books`**.  
   - –î–æ–±–∞–≤–∏—Ç—å `Depends(get_db)` –≤–æ **–≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –∫–Ω–∏–≥–∞–º–∏**.  

---

### **üìå –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ (–ü–æ–¥—Å–∫–∞–∑–∫–∞)**
#### **–§–∞–π–ª `dependencies.py (—á–∞—Å—Ç—å)`**
```python
from fastapi import Depends, HTTPException, status

# –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π API-–∫–ª—é—á
API_KEY = "supersecretkey"

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ API-–∫–ª—é—á–∞
def verify_api_key(api_key: str = "fake_key"):
    if api_key != API_KEY:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="Invalid API Key",
        )
    return api_key

# –§—É–Ω–∫—Ü–∏—è-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è "–±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"
def get_db():
    db = {}  # –≠—Ç–æ –Ω–∞—à–∞ "–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö" (–∏–º–∏—Ç–∞—Ü–∏—è)
    return db
```

---

### **üìå –ü—Ä–∏–º–µ—Ä –≤—ã–∑–æ–≤–∞ API (–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è)**  
- `GET /books` **(–¥–æ—Å—Ç—É–ø–µ–Ω –±–µ–∑ API-–∫–ª—é—á–∞)**.  
- `POST /books` **(—Ç—Ä–µ–±—É–µ—Ç API-–∫–ª—é—á–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞)**.  
- `GET /books/{book_id}` **(—Ç—Ä–µ–±—É–µ—Ç API-–∫–ª—é—á–∞)**.  
- `PUT /books/{book_id}` **(—Ç—Ä–µ–±—É–µ—Ç API-–∫–ª—é—á–∞)**.  
- `DELETE /books/{book_id}` **(—Ç—Ä–µ–±—É–µ—Ç API-–∫–ª—é—á–∞)**.  

---

### **üìå –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞–Ω–∏—è**
‚úÖ –ï—Å–ª–∏ API-–∫–ª—é—á –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π ‚Üí **–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è 401 Unauthorized**.  
‚úÖ `Depends(get_db)` **–ø–µ—Ä–µ–¥–∞—ë—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏**.  
‚úÖ –ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫ API-–∫–ª—é—á–∞ –≤–æ –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö.  

---

# **üìå –ò—Ç–æ–≥** 
- **–¢–ó 2 (`Depends()`)**: –í–Ω–µ–¥—Ä–∏—Ç—å –∑–∞—â–∏—Ç—É API-–∫–ª—é—á–æ–º –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.  
